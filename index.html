<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday Lakshtu ðŸ’–</title>

<style>
/* ---------- Fonts + root colors ---------- */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
:root{
  --bg1:#fff0ec; --bg2:#ffe8f6;
  --peach:#ffb88c; --pink:#ff4f9a; --muted:#5b3140;
  --glass: rgba(255,255,255,0.96);
}

/* ---------- Base ---------- */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(160deg,var(--bg1),var(--bg2));color:var(--muted);-webkit-font-smoothing:antialiased}
.center{display:flex;align-items:center;justify-content:center}
.container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;position:relative;overflow:hidden}

/* subtle background movement */
.bg-soft{position:absolute;inset:-20%;background:
  radial-gradient(circle at 10% 20%, rgba(255,210,190,0.12), transparent 12%),
  radial-gradient(circle at 80% 80%, rgba(230,200,255,0.08), transparent 12%);
  transform:scale(1.02); animation:bgMove 14s linear infinite; z-index:0}
@keyframes bgMove{0%{transform:translateY(0) scale(1.02)}50%{transform:translateY(-30px) scale(1.01)}100%{transform:translateY(0) scale(1.02)}}

/* ---------- Card ---------- */
.card{position:relative;z-index:4;width:100%;max-width:920px;background:var(--glass);border-radius:16px;padding:20px;box-shadow:0 30px 80px rgba(150,60,100,0.06);display:flex;flex-direction:column;align-items:center;gap:12px}
.header-heart{width:72px;height:72px;background-image:url('heart.png');background-size:contain;background-repeat:no-repeat;border-radius:12px;box-shadow:0 12px 32px rgba(255,110,170,0.12)}

/* ---------- Buttons ---------- */
.btn{display:inline-flex;align-items:center;gap:10px;padding:12px 20px;border-radius:999px;border:none;color:white;font-weight:700;cursor:pointer;background:linear-gradient(180deg,var(--peach),var(--pink));box-shadow:0 12px 30px rgba(255,100,150,0.14);transition:transform .18s}
.btn:active{transform:translateY(1px)}
.btn.secondary{background:linear-gradient(180deg,#aebaff,#c89bff)}

/* ---------- Intro ---------- */
#intro{width:100%;display:flex;flex-direction:column;align-items:center;gap:12px;padding:6px}

/* ---------- Stages (stacked, centered) ---------- */
.stage{width:100%;display:flex;flex-direction:column;align-items:center;gap:10px;transition:opacity .6s, transform .6s}
.hidden{display:none}

/* ---------- Envelope ---------- */
#envelope{width:320px;max-width:86vw;border-radius:12px;cursor:pointer;box-shadow:0 18px 40px rgba(0,0,0,0.12);transition:transform .6s}
#envelope:hover{transform:translateY(-6px)}

/* ---------- Tree area (heart-built tree) ---------- */
#treeWrap{width:100%;max-width:420px;height:380px;position:relative;display:flex;align-items:center;justify-content:center}
#treeCanvas{width:100%;height:100%}
#leafLayer{position:absolute;left:50%;transform:translateX(-50%);bottom:70px;width:320px;height:220px;pointer-events:none}

/* heart element (used to build the tree) */
.tree-heart{position:absolute;width:30px;height:30px;background-image:url('heart.png');background-size:contain;background-repeat:no-repeat;opacity:0;transform:scale(.35) translateY(18px);transition:transform .9s cubic-bezier(.2,.9,.2,1),opacity .9s,filter .9s}
.tree-heart.pop{opacity:1;transform:scale(1) translateY(0);filter:drop-shadow(0 10px 22px rgba(255,120,170,0.14))}

/* ---------- Cake ---------- */
#cakeBox{display:flex;flex-direction:column;align-items:center;gap:8px}
#cakeImg{width:360px;max-width:88vw;border-radius:16px;cursor:pointer;box-shadow:0 26px 68px rgba(0,0,0,0.12);transition:transform .18s}
#cakeImg:active{transform:scale(.94)}
.candle{position:relative;width:8px;height:36px;background:white;border-radius:8px;left:50%;transform:translateX(-50%);top:-56px;opacity:0}
.flame{position:absolute;left:50%;top:-18px;width:14px;height:14px;border-radius:50%;transform:translateX(-50%);background:radial-gradient(circle,#ffd800 0%, #ff5e00 70%);filter:drop-shadow(0 8px 14px rgba(255,120,60,0.3));opacity:0;transition:opacity .4s}

/* ---------- Balloons ---------- */
.balloon{position:absolute;width:44px;height:64px;border-radius:60% 60% 60% 60%;bottom:-120px;opacity:0;transform:translateY(0);transition:transform 3.2s cubic-bezier(.2,.9,.2,1),opacity .4s}
.balloon.one{left:12%;background:linear-gradient(180deg,#ff94c8,#ff4f9a)}
.balloon.two{right:14%;background:linear-gradient(180deg,#ffd17a,#ff7a5a)}

/* ---------- Gift (lid opens) ---------- */
#gift3D{width:240px;height:140px;border-radius:12px;background:linear-gradient(180deg,#fff3e6,#ffd6b3);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 22px 68px rgba(255,150,120,0.12);position:relative;overflow:visible;transform-style:preserve-3d;transition:transform .45s}
.lid{position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:260px;height:44px;background:linear-gradient(180deg,#ffd8b0,#ffb07a);border-radius:8px;transform-origin:50% 100%;transition:transform .6s cubic-bezier(.2,.9,.2,1)}
.lid.open{transform:translateX(-50%) rotateX(-78deg) translateY(-14px)}

/* ---------- Final panel & typing ---------- */
#finalPanel{width:92%;max-width:760px;background:linear-gradient(180deg,#fff7f9,#fff2f6);border-radius:14px;padding:18px;margin-top:12px;box-shadow:0 20px 48px rgba(255,150,190,0.07);display:none;text-align:left}
.typewriter{white-space:pre-wrap;font-weight:500;font-size:16px}
.cursor{display:inline-block;width:10px;height:18px;background:var(--pink);margin-left:8px;border-radius:3px;animation:blink 1s steps(2,start) infinite}
@keyframes blink{50%{opacity:0}}

/* ---------- Photo gallery ---------- */
.gallery{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.gallery img{width:270px;max-width:86vw;border-radius:12px;box-shadow:0 22px 60px rgba(0,0,0,0.10);opacity:0;transform:translateY(18px) scale(.98);transition:transform .6s,opacity .6s}
.gallery img.show{opacity:1;transform:translateY(0) scale(1)}

/* ---------- confetti & sparkle ---------- */
.confetti{position:absolute;width:8px;height:8px;border-radius:50%;pointer-events:none;opacity:.95;transform:translateY(-120px);animation:confettiFall 2.4s linear forwards}
@keyframes confettiFall{to{transform:translateY(250px) rotate(360deg);opacity:0.6}}
.sparkle{position:absolute;width:6px;height:6px;border-radius:50%;pointer-events:none;transform:scale(.2);animation:sparklePop 700ms ease forwards}
@keyframes sparklePop{0%{transform:scale(.2) translateY(0);opacity:0}40%{transform:scale(1.05) translateY(-6px);opacity:1}100%{transform:scale(.6) translateY(-30px);opacity:0}}

/* responsive */
@media (max-width:560px){ .gallery img{width:86vw} #cakeImg{width:86vw} #envelope{width:86vw} }
</style>
</head>
<body>
<div class="bg-soft" aria-hidden="true"></div>

<div class="container center" id="app">
  <div class="card center" role="main">
    <div class="header-heart" aria-hidden="true"></div>
    <div id="intro" class="center">
      <h2 style="margin:6px 0;color:var(--pink)">It's your special day!</h2>
      <div style="color:#7a3b54;margin-bottom:6px">Ready to open your surprise?</div>
      <div style="display:flex;gap:12px">
        <button id="startBtn" class="btn">Yes â€” Show me ðŸ’–</button>
        <button id="openGalleryBtn" class="btn secondary">Open Gallery</button>
      </div>
    </div>

    <!-- Envelope stage -->
    <div id="envelopeStage" class="stage hidden" style="margin-top:10px">
      <img id="envelope" src="envelope.png" alt="envelope">
      <div class="mini">Tap the envelope to open ðŸ’Œ</div>
    </div>

    <!-- Tree stage (heart-built) -->
    <div id="treeStage" class="stage hidden" style="margin-top:8px">
      <div id="treeWrap">
        <svg id="treeCanvas" viewBox="0 0 380 340" style="width:100%;height:100%"></svg>
        <div id="leafLayer"></div>
      </div>
      <div class="mini">The tree will slowly grow and blossoms will bloom ðŸŒ³ðŸ’–</div>
    </div>

    <!-- Cake stage -->
    <div id="cakeStage" class="stage hidden" style="margin-top:8px">
      <div id="cakeBox" class="center">
        <div class="candle" id="candle"><div class="flame" id="flame"></div></div>
        <img id="cakeImg" src="cake.jpg" alt="cake">
      </div>
      <div class="mini">Tap the cake to cut it ðŸŽ‚</div>
    </div>

    <!-- Balloons (visual) -->
    <div id="balloon1" class="balloon one" aria-hidden="true"></div>
    <div id="balloon2" class="balloon two" aria-hidden="true"></div>

    <!-- Gift -->
    <div id="giftStage" class="stage hidden" style="margin-top:12px">
      <div id="gift3D">
        <div class="lid" id="lid"></div>
        <div id="giftText">Open Gift</div>
      </div>
    </div>

    <!-- Final letter -->
    <div id="finalStage" class="stage hidden" style="margin-top:12px">
      <div id="finalPanel">
        <div id="typed" class="typewriter"></div><span id="cursor" class="cursor"></span>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="skipBtn" class="btn" style="background:linear-gradient(180deg,#ffe6e8,#ff9ab1)">Skip Typing</button>
        <button id="replayBtn" class="btn" style="background:linear-gradient(180deg,#a3ffd8,#7af1c4)">Replay Message</button>
      </div>
    </div>

    <!-- Gallery -->
    <div id="gallery" class="stage hidden" style="margin-top:12px; width:100%">
      <div class="gallery" id="photoGrid">
        <img id="img1" src="pic_one.jpg" alt="photo 1">
        <img id="img2" src="pic_two.jpg" alt="photo 2">
        <img id="img3" src="pic_three.png" alt="photo 3">
      </div>
    </div>

  </div>
</div>

<!-- confetti container -->
<div id="confettiRoot" aria-hidden="true"></div>

<!-- audio -->
<audio id="bgm" src="song.mp3" preload="auto" loop></audio>

<script>
/* ---------- Elements ---------- */
const startBtn = document.getElementById('startBtn');
const openGalleryBtn = document.getElementById('openGalleryBtn');

const envelopeStage = document.getElementById('envelopeStage');
const envelope = document.getElementById('envelope');

const treeStage = document.getElementById('treeStage');
const leafLayer = document.getElementById('leafLayer');

const cakeStage = document.getElementById('cakeStage');
const cakeImg = document.getElementById('cakeImg');
const flame = document.getElementById('flame');
const candle = document.getElementById('candle');

const giftStage = document.getElementById('giftStage');
const gift3D = document.getElementById('gift3D');
const lid = document.getElementById('lid');

const finalStage = document.getElementById('finalStage');
const typed = document.getElementById('typed');
const cursor = document.getElementById('cursor');
const skipBtn = document.getElementById('skipBtn');
const replayBtn = document.getElementById('replayBtn');

const gallery = document.getElementById('gallery');
const photoGrid = document.getElementById('photoGrid');
const photoImgs = [document.getElementById('img1'), document.getElementById('img2'), document.getElementById('img3')];

const confettiRoot = document.getElementById('confettiRoot');
const bgm = document.getElementById('bgm');

/* ---------- Audio tones ---------- */
let audioCtx=null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function playTone(freq=800,dur=220){ ensureAudio(); const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='triangle'; o.frequency.value=freq; const o2=audioCtx.createOscillator(); o2.type='sine'; o2.frequency.value=freq*1.45; g.gain.setValueAtTime(0,audioCtx.currentTime); g.gain.linearRampToValueAtTime(0.12,audioCtx.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur/1000); o.connect(g); o2.connect(g); g.connect(audioCtx.destination); o.start(); o2.start(); setTimeout(()=>{ o.stop(); o2.stop(); g.disconnect(); }, dur+30); }

/* ---------- helpers: confetti & sparkles ---------- */
function spawnConfettiAt(x,y,count=10,root=document.body){
  for(let i=0;i<count;i++){
    const c = document.createElement('div'); c.className='confetti';
    c.style.left = (x + (Math.random()*80-40)) + 'px';
    c.style.top = (y + (Math.random()*40-20)) + 'px';
    c.style.background = `hsl(${Math.random()*40 + 320},82%,76%)`;
    root.appendChild(c);
    setTimeout(()=> c.remove(), 2600 + Math.random()*1200);
  }
}
function spawnSparklesOver(el,count=8){
  const r = el.getBoundingClientRect();
  for(let i=0;i<count;i++){
    const s = document.createElement('div'); s.className='sparkle';
    s.style.left = (r.left + 8 + Math.random()*(r.width-16)) + 'px';
    s.style.top = (r.top + 8 + Math.random()*(r.height-16)) + 'px';
    s.style.background = `hsl(${Math.random()*40 + 320},82%,76%)`;
    document.body.appendChild(s);
    setTimeout(()=> s.remove(), 900 + Math.random()*600);
  }
}

/* ---------- Stage flow ---------- */
startBtn.addEventListener('click', ()=>{
  // reveal envelope; start audio (user initiated)
  bgm.play().catch(()=>{});
  document.getElementById('intro').style.display='none';
  envelopeStage.classList.remove('hidden'); envelopeStage.style.opacity=1;
});

openGalleryBtn.addEventListener('click', ()=> {
  gallery.classList.remove('hidden');
  photoImgs.forEach((img,i)=> setTimeout(()=> img.classList.add('show'), 200 + i*300));
});

/* Envelope -> tree */
envelope.addEventListener('click', async ()=>{
  envelopeStage.classList.add('hidden');
  treeStage.classList.remove('hidden');

  // simulate slow trunk fade-in
  const svgTrunk = document.querySelector('#treeCanvas rect');
  svgTrunk.style.opacity = 0;
  setTimeout(()=> { svgTrunk.style.transition='opacity 1.2s ease'; svgTrunk.style.opacity = 1; }, 80);

  // draw branches slow (stroke-dash technique)
  const branches = Array.from(document.querySelectorAll('.branch'));
  for(let i=0;i<branches.length;i++){
    const b = branches[i];
    const len = b.getTotalLength();
    b.style.strokeDasharray = len;
    b.style.strokeDashoffset = len;
  }
  // animate each branch slowly
  for(let i=0;i<branches.length;i++){
    const b = branches[i];
    await new Promise(r => setTimeout(r, 600 + i*700)); // slow
    b.style.transition = 'stroke-dashoffset 1100ms ease-in-out';
    b.style.strokeDashoffset = 0;
    playTone(560 + i*70, 160);
  }

  // create heart-buds slowly (bloom)
  await new Promise(r=>setTimeout(r, 600));
  const budCount = 14;
  for(let i=0;i<budCount;i++){
    createTreeHeart(i);
    await new Promise(r=>setTimeout(r, 260));
  }

  // after tree done show cake
  await new Promise(r=>setTimeout(r, 1400));
  treeStage.classList.add('hidden');
  cakeStage.classList.remove('hidden');
  showCandle();
});

/* Create a heart positioned in "tree" shape */
function createTreeHeart(index){
  // distribute hearts in triangular tree area
  const width = leafLayer.clientWidth || 320;
  const height = leafLayer.clientHeight || 160;
  // make y lower (bigger) for more fullness at bottom
  const layer = Math.floor(Math.random()*4); // layer 0..3
  const y = height * (0.25 + layer*0.18 + Math.random()*0.06);
  // x spread depends on layer (wider at bottom)
  const spread = 0.4 + layer*0.2 + Math.random()*0.25;
  const center = width/2;
  const x = center + (Math.random()*2 -1) * width * spread * 0.4;
  const el = document.createElement('div'); el.className='tree-heart';
  el.style.left = Math.max(4, Math.min(width-34, x)) + 'px';
  el.style.top = Math.max(2, Math.min(height-34, y)) + 'px';
  leafLayer.appendChild(el);
  setTimeout(()=> { el.classList.add('pop'); playTone(720 + Math.random()*200, 160); }, 140 + index*220);
  // gentle float and fade later
  setTimeout(()=> {
    el.style.transition = 'transform 2200ms ease, opacity 2200ms ease';
    el.style.transform = `translateY(-72px) scale(.6) rotate(${Math.random()*520}deg)`;
    el.style.opacity = 0;
    setTimeout(()=> el.remove(), 2300);
  }, 3200 + Math.random()*1600);
}

/* Cake -> cut -> balloons + confetti -> show gift */
function showCandle(){
  candle.style.opacity = 1;
  flame.style.opacity = 1;
  flame.animate([{transform:'translateY(0) scale(1)'},{transform:'translateY(-6px) scale(1.06)'},{transform:'translateY(0) scale(1)'}],{duration:900,iterations:Infinity});
}

cakeImg.addEventListener('click', ()=>{
  // small press
  cakeImg.classList.add('press');
  setTimeout(()=> cakeImg.classList.remove('press'), 160);
  // confetti on cake
  const rect = cakeImg.getBoundingClientRect();
  spawnConfettiAt(rect.left + rect.width/2, rect.top + 20, 14);
  // balloons rise
  const b1 = document.getElementById('balloon1'), b2 = document.getElementById('balloon2');
  b1.style.opacity = 1; b1.style.transform = 'translateY(-420px)'; b1.style.transition='transform 3800ms cubic-bezier(.2,.9,.2,1), opacity 400ms';
  setTimeout(()=> { b2.style.opacity = 1; b2.style.transform = 'translateY(-360px)'; b2.style.transition='transform 3400ms cubic-bezier(.2,.9,.2,1), opacity 400ms'; }, 260);
  // show gift after small delay
  setTimeout(()=> { cakeStage.classList.add('hidden'); giftStage.classList.remove('hidden'); openLid(); }, 1400);
});

/* Gift lid open + confetti */
function openLid(){
  lid.classList.add('open');
  playTone(940, 240);
  spawnConfettiAt(window.innerWidth/2, window.innerHeight/2, 26);
  spawnSparklesOver(document.getElementById('gift3D'), 12);
  // after lid open -> show final message
  setTimeout(()=> {
    giftStage.classList.add('hidden');
    finalStage.classList.remove('hidden');
    startTyping();
  }, 900);
}

/* ---------- Typewriter (user chose 'A') ---------- */
const finalMessage = `My sweet Lakshtu,

You make my world brighter just by being in it. You are the kindest part of my heart â€” the calm in my chaos, and the softest place where my feelings rest.

Thank you for loving me in your own little ways, for supporting me, for choosing me, and for making every day feel special without even trying.

On your birthday, I just want you to know â€” you are precious to me, you are loved more than words can hold, and you will always, always have a place in my heart.

Happy Birthday, my love.
My sweetest girl.
My Lakshtu. ðŸ’–âœ¨`;

let typTimer = null, typIndex = 0, isTyping = false;
function startTyping(){
  typed.textContent = ''; typIndex = 0; isTyping = true; cursor.style.display='inline-block';
  function step(){
    if(typIndex < finalMessage.length){
      const ch = finalMessage.charAt(typIndex++);
      typed.textContent += ch;
      if(ch === '\n'){ spawnSparklesOver(document.getElementById('finalPanel'), 8); playTone(720 + Math.random()*280, 220); }
      typTimer = setTimeout(step, 28 + Math.random()*18);
    } else {
      isTyping = false; cursor.style.display='none';
      // show gallery photos after slight pause
      setTimeout(()=> revealGallery(), 700);
    }
  }
  step();
}
skipBtn.addEventListener('click', ()=>{
  if(isTyping){
    clearTimeout(typTimer);
    typed.textContent = finalMessage;
    isTyping = false; cursor.style.display='none';
    setTimeout(()=> revealGallery(), 350);
  }
});
replayBtn.addEventListener('click', ()=>{ if(typTimer) clearTimeout(typTimer); typed.textContent=''; startTyping(); });

/* ---------- Reveal gallery (3 photos) ---------- */
function revealGallery(){
  gallery.classList.remove('hidden');
  photoImgs.forEach((im,i)=> setTimeout(()=> im.classList.add('show'), 220 + i*420));
}

/* ---------- safety: check assets presence (best-effort) ---------- */
(async function checkAssets(){
  const files = ['song.mp3','envelope.png','cake.jpg','heart.png','pic_one.jpg','pic_two.jpg','pic_three.png'];
  const missing = [];
  for(const f of files){
    try{
      const r = await fetch(f,{method:'HEAD'}); if(!r.ok) missing.push(f);
    }catch(e){ missing.push(f); }
  }
  if(missing.length) console.warn('Missing files (ensure they are in repo root):', missing);
})();

/* pause bgm when leaving */
window.addEventListener('pagehide', ()=> bgm.pause());
</script>
</body>
</html>
