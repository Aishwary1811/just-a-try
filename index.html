<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday Lakshtu üíñ</title>
<style>
  /* ---------- Base ---------- */
  @font-face{
    font-family: PoppinsLocal;
    src: local('Poppins'), local('Segoe UI'), local('Helvetica Neue'), local('Arial');
  }
  :root{
    --bg1:#fff6f3; --bg2:#ffeef9; --accent:#ff4f9a; --rose: #ff5e8a; --muted:#63414a;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:PoppinsLocal,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    background:linear-gradient(160deg,var(--bg1),var(--bg2));
    color:var(--muted);min-height:100vh;display:flex;align-items:center;justify-content:center;
    padding:18px;
  }
  .container{width:100%;max-width:980px;background:rgba(255,255,255,0.98);border-radius:16px;padding:22px;box-shadow:0 30px 80px rgba(120,50,80,0.06);display:flex;flex-direction:column;align-items:center;gap:16px;}
  h1{margin:0;color:var(--rose);font-weight:700}
  .btn{padding:12px 22px;border-radius:999px;border:none;color:white;font-weight:800;background:linear-gradient(90deg,#ffb88c,#ff4f9a);cursor:pointer;box-shadow:0 12px 28px rgba(255,100,150,0.14)}
  .stage{display:none;flex-direction:column;align-items:center;gap:12px;width:100%}
  .stage.active{display:flex}
  small{color:#7a3b54}
  /* Gallery */
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;width:92%}
  .gallery-item{border-radius:14px;overflow:hidden;box-shadow:0 10px 26px rgba(0,0,0,0.12)}
  .gallery-item img{width:100%;height:100%;object-fit:cover;display:block}
  /* final panel */
  #finalPanel{display:none;width:92%;max-width:820px;background:linear-gradient(180deg,#fff7f9,#fff2f6);border-radius:14px;padding:18px;box-shadow:0 20px 48px rgba(255,150,190,0.07)}
  .typewriter{white-space:pre-wrap;font-weight:500;font-size:16px}
  .cursor{display:inline-block;width:10px;height:18px;background:var(--accent);margin-left:8px;border-radius:3px;animation:blink 1s steps(2,start) infinite}
  @keyframes blink{50%{opacity:0}}
  /* SVG area */
  #svgWrap{width:100%;display:flex;justify-content:center}
  svg{max-width:520px;width:90vw;height:auto;overflow:visible}
  /* trunk/branch drawing */
  .branch-stroke{fill:none;stroke:#6d4633;stroke-linecap:round;stroke-linejoin:round;stroke-width:10;filter:drop-shadow(0 10px 22px rgba(0,0,0,0.08))}
  .branch-thin{stroke-width:8;opacity:0.95}
  .canopy-outline{fill:none;stroke:rgba(255,94,138,0.06);stroke-width:0}
  /* blossoms hearts (base style) */
  .blossom{transform-origin:center center;opacity:0;transition: transform 600ms cubic-bezier(.2,.9,.2,1), opacity 400ms}
  .blossom.show{opacity:1;transform:scale(1)}
  /* gentle pulse for shown blossoms */
  .blossom.pulse{animation: pulse 2600ms ease-in-out infinite}
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
  /* falling petals */
  .petal{fill:var(--rose);opacity:.95;transform-origin:center center}
  /* small helpers */
  .center-note{font-size:14px;color:#7a3b54}
  /* responsive */
  @media (min-width:1000px){ svg{width:520px} }
</style>
</head>
<body>
<div class="container" role="main" aria-labelledby="title">
  <h1 id="title">Happy Birthday Lakshtu üíñ</h1>

  <!-- INTRO -->
  <div id="intro" class="stage active">
    <div style="text-align:center">
      <div style="font-size:18px;font-weight:600">It's your special day!</div>
      <small>Ready to open your surprise?</small>
    </div>
    <button id="startBtn" class="btn">Start & Play Music üíñ</button>
  </div>

  <!-- ENVELOPE -->
  <div id="envelopeStage" class="stage" role="button" tabindex="0" aria-label="Open envelope">
    <!-- simple inline envelope svg -->
    <svg width="260" height="120" viewBox="0 0 260 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <linearGradient id="envG" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#fff"/>
          <stop offset="1" stop-color="#fff6fb"/>
        </linearGradient>
      </defs>
      <rect x="6" y="14" rx="12" ry="12" width="248" height="92" fill="url(#envG)" stroke="#ffdcee" stroke-width="1.5" />
      <path d="M14 24 L130 68 L246 24" fill="none" stroke="#ffd0e4" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <text x="130" y="90" text-anchor="middle" fill="#ff5e8a" font-size="18" font-weight="700">Open üíå</text>
    </svg>
    <small>Tap the envelope üíå</small>
  </div>

  <!-- TREE (SVG drawn, animated) -->
  <div id="treeStage" class="stage" aria-live="polite">
    <div id="svgWrap" aria-hidden="false">
      <svg id="treeSVG" viewBox="0 0 520 520" role="img" aria-label="Animated Sakura Heart Tree">
        <!-- trunk + main branches (paths drawn, animated by stroke-dashoffset) -->
        <g id="trunkGroup" transform="translate(260,460)">
          <!-- trunk path (from ground up) -->
          <path id="trunkPath" class="branch-stroke branch-thin" d="M0 0 C -8 -20 -20 -160 -24 -200 C -28 -250 -48 -300 -36 -340 C -24 -380 18 -390 40 -360 C 62 -330 80 -260 86 -220 C 90 -190 72 -80 54 -40" stroke-linecap="round"></path>
          <!-- a couple of thick branches -->
          <path id="b1" class="branch-stroke" d="M8 -110 C 44 -140 140 -190 200 -200" stroke-linecap="round"></path>
          <path id="b2" class="branch-stroke" d="M-12 -130 C -60 -160 -150 -220 -210 -210" stroke-linecap="round"></path>
          <path id="b3" class="branch-stroke" d="M28 -80 C 72 -100 110 -120 160 -120" stroke-linecap="round"></path>
          <path id="b4" class="branch-stroke" d="M-6 -70 C -34 -90 -70 -110 -110 -100" stroke-linecap="round"></path>
        </g>

        <!-- soft canopy guide path (heart-shaped param curve, invisible) -->
        <path id="canopyGuide" class="canopy-outline" d="" />

        <!-- group to hold blossoms (hearts) -->
        <g id="blossoms" transform="translate(0,0)"></g>

        <!-- group for falling petals -->
        <g id="petalLayer"></g>
      </svg>
    </div>
    <div class="center-note">Watch the tree grow and blossom üå∏‚ù§Ô∏è</div>
  </div>

  <!-- CAKE -->
  <div id="cakeStage" class="stage">
    <!-- simple cake placeholder; users can replace with cake.jpg -->
    <svg width="380" height="220" viewBox="0 0 380 220" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <rect x="36" y="64" rx="18" width="308" height="120" fill="#fff0f6" stroke="#ffd6e8" />
      <rect x="72" y="30" rx="10" width="236" height="44" fill="#ffd6d9" />
      <text x="190" y="140" text-anchor="middle" fill="#b05462" font-weight="700">Tap the cake to cut it üéÇ</text>
    </svg>
    <small>Tap the cake to cut it üéÇ</small>
  </div>

  <!-- GIFT -->
  <div id="giftStage" class="stage">
    <div id="gift3D" style="width:240px;height:150px;border-radius:12px;background:linear-gradient(180deg,#fff3e6,#ffd6b3);display:flex;align-items:center;justify-content:center;position:relative;box-shadow:0 22px 68px rgba(255,150,120,0.12);cursor:pointer">
      <div id="lid" style="position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:260px;height:44px;background:linear-gradient(180deg,#ffd8b0,#ffb07a);border-radius:8px;transform-origin:50% 100%;transition:transform .6s"></div>
      <div style="font-weight:700;color:#6b3a3f">Open Gift</div>
    </div>
  </div>

  <!-- FINAL LETTER -->
  <div id="finalStage" class="stage">
    <div id="finalPanel">
      <div id="typed" class="typewriter"></div><span id="cursor" class="cursor"></span>
    </div>
  </div>

  <!-- GALLERY -->
  <section id="gallery" class="stage" style="padding:18px;width:100%">
    <h3 style="color:var(--rose);margin:0">Our Beautiful Moments üíó</h3>
    <div class="gallery-grid" id="galleryGrid">
      <div class="gallery-item"><img src="pic_three.png" alt=""></div>
      <div class="gallery-item"><img src="pic_one.jpg" alt=""></div>
      <div class="gallery-item"><img src="pic_two.jpg" alt=""></div>
    </div>
  </section>

</div>

<audio id="bgm" src="song.mp3" preload="auto" loop></audio>

<script>
/* ---------------- Setup ---------------- */
const startBtn = document.getElementById('startBtn');
const envelopeStage = document.getElementById('envelopeStage');
const treeStage = document.getElementById('treeStage');
const cakeStage = document.getElementById('cakeStage');
const giftStage = document.getElementById('giftStage');
const finalStage = document.getElementById('finalStage');
const galleryStage = document.getElementById('gallery');
const bgm = document.getElementById('bgm');
const trunkPath = document.getElementById('trunkPath');
const bPaths = [document.getElementById('b1'), document.getElementById('b2'), document.getElementById('b3'), document.getElementById('b4')];
const blossomsGroup = document.getElementById('blossoms');
const petalLayer = document.getElementById('petalLayer');
const canopyGuide = document.getElementById('canopyGuide');
const lid = document.getElementById('lid');

/* Start -> envelope stage */
startBtn.addEventListener('click', ()=> {
  bgm.play().catch(()=>{});
  document.getElementById('intro').classList.remove('active');
  envelopeStage.classList.add('active');
});

/* keyboard accessibility for envelope */
envelopeStage.addEventListener('keydown', e=>{
  if(e.key==='Enter' || e.key===' ') { e.preventDefault(); envelopeStage.click(); }
});

/* Envelope click -> grow tree */
envelopeStage.addEventListener('click', async ()=> {
  envelopeStage.classList.remove('active');
  treeStage.classList.add('active');

  // 1) animate trunk and branches drawing using stroke-dash technique
  await drawPath(trunkPath, 1200, 0);
  // small delay between branches
  for(let i=0;i<bPaths.length;i++){
    await drawPath(bPaths[i], 700, 120*i);
  }

  // 2) build canopy guide (heart-like shape) and calculate blossom positions
  buildCanopyGuide();

  // 3) spawn blossoms along branches + canopy
  await bloomBlossoms({count:70, tempo:60});

  // 4) start gentle falling petals loop
  startPetalShower(14);

  // after a pause, automatically go to cake
  setTimeout(()=>{
    treeStage.classList.remove('active');
    cakeStage.classList.add('active');
  }, 3800);
});

/* Cake click -> gift */
cakeStage.addEventListener('click', ()=>{
  cakeStage.classList.remove('active');
  giftStage.classList.add('active');
});

/* Gift click */
giftStage.addEventListener('click', ()=>{
  lid.style.transform = 'translateX(-50%) rotateX(-78deg)';
  setTimeout(()=>{
    giftStage.classList.remove('active');
    galleryStage.classList.add('active');
    finalStage.classList.add('active');
    startTyping();
  },900);
});

/* Typing message */
const message = `My sweet Lakshtu,

You make my world brighter just by being in it. You are the kindest part of my heart ‚Äî the calm in my chaos, and the softest place where my feelings rest.

Thank you for loving me in your own little ways, for supporting me, for choosing me, and for making every day feel special without even trying.

On your birthday, I just want you to know ‚Äî you are precious to me, you are loved more than words can hold, and you will always, always have a place in my heart.

I LOVE YOU, LAKSHTU üíñ‚ú®`;

const typedEl = document.getElementById('typed');
const cursor = document.getElementById('cursor');

function startTyping(){
  typedEl.textContent = '';
  cursor.style.display = 'inline-block';
  let i=0;
  function step(){
    if(i<message.length){ typedEl.textContent += message.charAt(i++); setTimeout(step, 18 + Math.random()*26); }
    else cursor.style.display='none';
  }
  step();
}

/* ---------------- SVG helpers ---------------- */

/* Draw path animation using stroke-dasharray */
function drawPath(pathEl, duration=800, delay=0){
  return new Promise(res=>{
    const len = pathEl.getTotalLength();
    pathEl.style.strokeDasharray = len;
    pathEl.style.strokeDashoffset = len;
    pathEl.getBoundingClientRect(); // force reflow
    pathEl.style.transition = `stroke-dashoffset ${duration}ms cubic-bezier(.2,.9,.2,1) ${delay}ms`;
    pathEl.style.strokeDashoffset = '0';
    setTimeout(()=>res(), duration + delay + 30);
  });
}

/* Build canopy guide (parametric heart) */
function buildCanopyGuide(){
  // heart param: use scaled param curve centered above trunk base
  const pts = [];
  for(let t=0;t<Math.PI*2; t+=Math.PI*2/120){
    // classic heart param
    const x = 16 * Math.pow(Math.sin(t),3);
    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
    pts.push({x,y});
  }
  // normalize to SVG space: canopy center around (260,150)
  const xs = pts.map(p=>p.x), ys = pts.map(p=>p.y);
  const minx=Math.min(...xs), maxx=Math.max(...xs), miny=Math.min(...ys), maxy=Math.max(...ys);
  const W = 380, H = 220; // local scale
  const cx = 260, cy = 170;
  // map and build path string
  const mapped = pts.map(p=>{
    const nx = (p.x - minx) / (maxx - minx);
    const ny = (p.y - miny) / (maxy - miny);
    const left = cx - W*0.45 + nx*W*0.9; // spread horizontally
    const top  = cy - H*0.6 + ny*(H*0.95); // compress vertically
    return {x:left, y:top};
  });
  let d = '';
  mapped.forEach((p,i)=> d += (i===0?`M ${p.x} ${p.y}`:` L ${p.x} ${p.y}`));
  canopyGuide.setAttribute('d', d + ' Z');
  // (canopyGuide is invisible; used for sampling positions)
}

/* Sample positions along trunk & branches and canopy guide for blossoms */
function samplePositions(desiredCount=70){
  const positions = [];
  // sample branch paths
  const allPaths = [trunkPath,...bPaths];
  allPaths.forEach(path=>{
    const L = path.getTotalLength();
    const samples = Math.max(6, Math.floor(desiredCount / 8));
    for(let i=0;i<samples;i++){
      const t = (i+0.2) / (samples+0.4); // avoid ends
      const p = path.getPointAtLength(L * t);
      positions.push({x: p.x + 260, y: p.y + 0}); // because trunkGroup translated earlier; trunkGroup translate used 260,460 - handled below
    }
  });

  // sample canopy guide (heart)
  const guideLen = canopyGuide.getTotalLength();
  const canopySamples = Math.floor(desiredCount * 0.6);
  for(let i=0;i<canopySamples;i++){
    const t = Math.random();
    const p = canopyGuide.getPointAtLength(guideLen * t);
    positions.push({x: p.x, y: p.y});
  }

  // jitter positions a bit and filter duplicates
  const shuffled = positions.sort(()=>0.5 - Math.random());
  const unique = [];
  const seen = new Set();
  for(const p of shuffled){
    const key = `${Math.round(p.x/6)}_${Math.round(p.y/6)}`;
    if(!seen.has(key)){ seen.add(key); unique.push(p); }
    if(unique.length >= desiredCount) break;
  }
  return unique;
}

/* create single heart blossom (SVG group) at (x,y) in SVG coordinates */
function createBlossom(x,y,scale=1.0){
  const ns = "http://www.w3.org/2000/svg";
  const g = document.createElementNS(ns,'g');
  g.setAttribute('class','blossom');
  g.setAttribute('transform',`translate(${x},${y}) scale(${0.001})`);
  // tiny random rotation
  const rot = (Math.random()*36 - 18);
  g.style.transformBox = 'fill-box';
  g.style.transformOrigin = 'center';
  // heart path (simple rounded heart)
  const path = document.createElementNS(ns,'path');
  path.setAttribute('d','M0 -6 C -6 -16 -24 -14 -24 -2 C -24 8 -4 20 0 24 C 4 20 24 8 24 -2 C 24 -14 6 -16 0 -6 Z');
  path.setAttribute('fill', '#ff7aa2'); // inner color
  path.setAttribute('stroke','#ff4f86');
  path.setAttribute('stroke-width','1');
  path.setAttribute('transform','scale(0.9)');
  g.appendChild(path);
  // halo (soft circle behind)
  const halo = document.createElementNS(ns,'ellipse');
  halo.setAttribute('cx',0);
  halo.setAttribute('cy',2);
  halo.setAttribute('rx',18);
  halo.setAttribute('ry',12);
  halo.setAttribute('fill','rgba(255,94,138,0.12)');
  halo.setAttribute('filter','none');
  g.insertBefore(halo, path);
  // store rotation in transform attribute
  g.dataset.rot = rot;
  return g;
}

/* bloomBlossoms - animate appearing blossoms, blossoms stay */
async function bloomBlossoms({count=60, tempo=70} = {}){
  const pos = samplePositions(count);
  for(let i=0;i<pos.length && i<count;i++){
    const p = pos[i];
    // create blossom
    const b = createBlossom(p.x, p.y, 1.0);
    // apply random initial scale and rotation
    const sx = 0.6 + Math.random()*0.8;
    b.setAttribute('transform', `translate(${p.x},${p.y}) scale(${0.001}) rotate(${Math.random()*40 - 20})`);
    blossomsGroup.appendChild(b);
    // small delay before showing
    await new Promise(r=>setTimeout(r, Math.floor(Math.random()*tempo) + 20));
    // show: set class and transform to scale 1
    b.classList.add('show');
    b.classList.add('pulse');
    // set transform with rotation preserved
    const rot = b.dataset.rot || (Math.random()*20 - 10);
    b.style.transition = 'transform 600ms cubic-bezier(.2,.9,.2,1), opacity 400ms';
    b.setAttribute('transform', `translate(${p.x},${p.y}) scale(1) rotate(${rot})`);
  }
}

/* startPetalShower - create falling small hearts/petals */
function startPetalShower(rate=10){
  // create petals periodically
  setInterval(()=>{
    const ns = "http://www.w3.org/2000/svg";
    const p = document.createElementNS(ns,'path');
    // small heart petal path scaled
    p.setAttribute('d','M0 -4 C -4 -8 -12 -6 -12 -1 C -12 5 -2 11 0 13 C 2 11 12 5 12 -1 C 12 -6 4 -8 0 -4 Z');
    p.setAttribute('fill', 'rgba(255,94,138,0.85)');
    p.setAttribute('opacity', 0.9);
    // random start position across canopy top
    const xs = 110 + Math.random() * 300;
    const ys = 70 + Math.random() * 40;
    p.setAttribute('transform', `translate(${xs},${ys}) scale(${0.6 + Math.random()*0.8}) rotate(${Math.random()*60 - 30})`);
    petalLayer.appendChild(p);
    // animate falling using SMIL-like JS (tween)
    const duration = 4200 + Math.random()*2400;
    const start = performance.now();
    const startX = xs;
    const endX = xs - (20 + Math.random()*80);
    const startY = ys;
    const endY = ys + 260 + Math.random()*60;
    function frame(now){
      const t = Math.min(1, (now - start) / duration);
      const ease = t; // linear ok
      const curX = startX + (endX - startX) * ease;
      const curY = startY + (endY - startY) * ease;
      const rot = (ease * 360) + (Math.random()*30);
      p.setAttribute('transform', `translate(${curX},${curY}) scale(${0.6 + Math.random()*0.8}) rotate(${rot})`);
      p.setAttribute('opacity', String(1 - ease));
      if(t < 1) requestAnimationFrame(frame);
      else p.remove();
    }
    requestAnimationFrame(frame);
  }, 900);
}

/* ---------------- Accessibility helpers ---------------- */
envelopeStage.addEventListener('keypress', e=>{ if(e.key==='Enter') envelopeStage.click(); });
document.getElementById('treeStage').addEventListener('keydown', e=>{ if(e.key==='Enter') {/* no-op */} });

/* ensure blossoms remain after resize by not clearing them */

/* End of script */
</script>
</body>
</html>
